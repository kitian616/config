## ## ##
# Author    Tian Qi (Thomas Tian)
# Email     kitian616@outlook.com
# Github    https://github.com/kitian616/config
# Version   2.0.2 - 05/11/2017
## ## ##

local _ZPLUG_HOME="$HOME/.zplug"
local _VUNDLE_HOME="$HOME/.vim/bundle/Vundle.vim"
local _NVM_HOME="$HOME/.nvm"
local _NVM_SH="/usr/local/opt/nvm/nvm.sh"
local _PYENV_HOME="$HOME/.pyenv"
local _RBENV_HOME="$HOME/.rbenv"
local CUSTOM_PLUGINS_PATH="~/.custom_scripts/plugins"


# utils
# 0 exit
cmd_exist() {
    if [[ $1 ]];then
        command $1 > /dev/null 2>&1
        echo "$?"
    fi
}

# homebrew
if [[ $(cmd_exist brew) -eq 0 ]]; then
    export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles
fi

# nvm
if [[ -d $_NVM_HOME ]] && [[ -e $_NVM_SH ]]; then
    export NVM_DIR=$_NVM_HOME
    . "$_NVM_SH"
fi

# pyenv
if [[ -e $_PYENV_HOME ]] && [[ $(cmd_exist pyenv) -eq 0 ]]; then
    export PYENV_ROOT=$_PYENV_HOME
    export PATH="$PYENV_ROOT/bin:$PATH"
    eval "$(pyenv init -)"
fi

# rbenv
if [[ -e $_RBENV_HOME ]] && [[ $(cmd_exist rbenv) -eq 0 ]]; then
    export PATH="$_RBENV_HOME/bin:$PATH"
    eval "$(rbenv init -)"
fi

# Yarn
if [[ $(cmd_exist 'yarn -V') -eq 0 ]]; then
    export PATH="$PATH:`yarn global bin`"
fi

# thefuck
##brew install thefuck
if [[ $(cmd_exist thefuck) -eq 0 ]]; then
    eval "$(thefuck --alias)"
fi

# auto install Vundle
if [[ ! -e "$_VUNDLE_HOME" ]]; then
    echo "install Vundle."
    git clone https://github.com/VundleVim/Vundle.vim.git $_VUNDLE_HOME
fi

# change default shell to ZSH
if [[ ! $SHELL == *zsh* ]]; then
    echo "change default shell to ZSH."
    chsh -s $(which zsh)
fi


## zplug
if [[ -e "$_ZPLUG_HOME/init.zsh" ]]; then
    export ZPLUG_HOME=$_ZPLUG_HOME
    source $_ZPLUG_HOME/init.zsh
else
    if [[ $(cmd_exist zplug) -ne 0 ]]; then
        echo "install zplug."
        git clone https://github.com/zplug/zplug $_ZPLUG_HOME
    fi
fi

# see https://github.com/robbyrussell/oh-my-zsh/wiki/Plugins for oh-my-zsh themes document.
zplug "lib/theme-and-appearance", from:oh-my-zsh
zplug "lib/directories", from:oh-my-zsh

zplug "plugins/z", from:oh-my-zsh
# clipcopy - Copy data to clipboard
# Usage:
#  <command> | clipcopy    - copies stdin to clipboard
#  clipcopy <file>         - copies a file's contents to clipboard
zplug "lib/clipboard", from:oh-my-zsh, if:"[[ $OSTYPE == *darwin* ]]"
zplug "lib/completion", from:oh-my-zsh
zplug "plugins/extract", from:oh-my-zsh

zplug "plugins/sudo", from:oh-my-zsh
zplug "plugins/command-not-found", from:oh-my-zsh
zplug "plugins/colored-man-pages", from:oh-my-zsh
zplug "zsh-users/zsh-syntax-highlighting"
zplug "zsh-users/zsh-completions"

zplug "plugins/git", from:oh-my-zsh

zplug "kitian616/tq-zsh-theme", as:theme

# Install plugins if there are plugins that have not been installed
if ! zplug check --verbose; then
    printf "Install? [y/N]: "
    if read -q; then
        echo; zplug installz
    fi
fi

# Then, source plugins and add commands to $PATH
zplug load --verbose


# load custom plugins
if [[ -d ~/.custom_scripts/plugins ]]; then
    for FILE in ~/.custom_scripts/plugins/*.sh; do
        source $FILE;
    done
fi