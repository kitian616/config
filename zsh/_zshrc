## ## ##
# Author    Tian Qi (Thomas Tian)
# Email     kitian616@outlook.com
# Github    https://github.com/kitian616/config
# Version   2.0.2 - 05/11/2017
## ## ##

local _NVM_HOME="$HOME/.nvm"
local _NVM_SH="/usr/local/opt/nvm/nvm.sh"
local _PYENV_HOME="$HOME/.pyenv"
local _RBENV_HOME="$HOME/.rbenv"

local CUSTOM_PLUGINS_PATH="~/.custom_scripts/plugins"

export ZPLUG_HOME=/usr/local/opt/zplug
source $ZPLUG_HOME/init.zsh

# utils
# 0 exit
cmd_exist() {
    if [[ $1 ]];then
        command $1 > /dev/null 2>&1
        echo "$?"
    fi
}

# homebrew
if [[ $(cmd_exist brew) -eq 0 ]]; then
    export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles
fi

# nvm
if [[ -d $_NVM_HOME ]] && [[ -e $_NVM_SH ]]; then
    export NVM_DIR=$_NVM_HOME
    . "$_NVM_SH"
fi

# pyenv
if [[ -e $_PYENV_HOME ]] && [[ $(cmd_exist pyenv) -eq 0 ]]; then
    export PYENV_ROOT=$_PYENV_HOME
    export PATH="$PYENV_ROOT/bin:$PATH"
    eval "$(pyenv init -)"
fi

# rbenv
if [[ -e $_RBENV_HOME ]] && [[ $(cmd_exist rbenv) -eq 0 ]]; then
    export PATH="$_RBENV_HOME/bin:$PATH"
    eval "$(rbenv init -)"
fi

# Yarn
if [[ $(cmd_exist 'yarn -V') -eq 0 ]]; then
    export PATH="$PATH:`yarn global bin`"
fi

# thefuck
##brew install thefuck
if [[ $(cmd_exist thefuck) -eq 0 ]]; then
    eval "$(thefuck --alias)"
fi

# zplug
source ~/.zplug/init.zsh

zplug "plugins/git", from:oh-my-zsh
zplug "plugins/sudo", from:oh-my-zsh
zplug "plugins/command-not-found", from:oh-my-zsh
zplug "plugins/colored-man-pages", from:oh-my-zsh
zplug "plugins/z", from:oh-my-zsh
zplug "plugins/extract", from:oh-my-zsh

zplug "zsh-users/zsh-syntax-highlighting"

zplug "kitian616/tq-zsh-theme", as:theme

# Install plugins if there are plugins that have not been installed
if ! zplug check --verbose; then
    printf "Install? [y/N]: "
    if read -q; then
        echo; zplug installz
    fi
fi

# Then, source plugins and add commands to $PATH
zplug load --verbose


# load custom plugins
if [[ -d ~/.custom_scripts/plugins ]]; then
    for FILE in ~/.custom_scripts/plugins/*.sh; do
        source $FILE;
    done
fi